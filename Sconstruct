import sys

libs = [
    'sfml-graphics',
    'sfml-system',
    'sfml-audio',
    'sfml-window',
    'luajit-5.1',
    'm',
    'dl'
]
cflags = [
    '-std=c++17',
    '-fdiagnostics-color=always',
    '-I/usr/include/luajit-2.1',
    '-I/usr/local/include/luajit-2.0',
]
lflags = []

if sys.platform != 'darwin':
    libs.append('GL')
else:
    cflags.append('-mmacosx-version-min=10.15')
    cflags.append('-stdlib=libc++')
    lflags.append(['-pagezero_size', '10000'])
    lflags.append(['-image_base', '10000000'])

mainSources = Glob('src/main/*.cc')
testSources = Glob('src/test/*.cc')

debugEnv = Environment(
    LIBS=libs,
    FRAMEWORKS=['OpenGl'],
    CXXFLAGS=cflags + ['-g'],
    LINKFLAGS=lflags
)
goodEnv = Environment(
    LIBS=libs,
    FRAMEWORKS=['OpenGl'],
    CXXFLAGS=cflags,
    LINKFLAGS=lflags
)

debugEnv.VariantDir("debug", "src", duplicate=0)
goodEnv.VariantDir("build", "src", duplicate=0)
spiderDebug = debugEnv.Program('spiderDebug', mainSources + ['src/main.cc'])
spider = goodEnv.Program('spider', mainSources + ['src/main.cc'])
test = goodEnv.Program('test', mainSources + testSources + ['src/catch.cc'])

Default(spider)
